{"name":"Building a web application with Mojolicious and Ember - Part Two","tagline":"7th February 2016","body":"This is the second part of a multi-part tutorial which will help you get started developing web applications using [Mojolicious](http://mojolicious.org) and [Ember](http://emberjs.com). In the [first part](http://keithbro.github.io/build-an-app-with-mojolicious-and-ember-part-1), we got everything installed and finished at the point where we had front-end and back-end development servers running. The following instructions assume that both servers are still running.\r\n\r\n## Our Application\r\n\r\nThe application we will create will be very simple, but will show how everything ties together and will lay the groundwork for building something more complex. On the landing page, the user will see a list of music artists. When the user clicks on each artist, they should see more information about that artist, including their albums. For the first iteration, the application will be read-only, but later on we'll add functionality such that the user can add artists and albums.\r\n\r\n## Ember Resources\r\n\r\nEmber-CLI provides the concept of a \"resource\" which consists of a model, a route and a template. If we generate a resource called artists, it will take us a long way towards our goal of displaying a list of artists to the user. We can also define what attributes artists should have, for example, a name which is a string.\r\n\r\n    ~/music-app/ember$ ember generate resource artists name:string\r\n    version: 1.13.15\r\n    installing model\r\n      create app/models/artist.js\r\n    installing model-test\r\n      create tests/unit/models/artist-test.js\r\n    installing route\r\n      create app/routes/artists.js\r\n      create app/templates/artists.hbs\r\n    updating router\r\n      add route artists\r\n    installing route-test\r\n      create tests/unit/routes/artists-test.js\r\n\r\nThat generated a lot of code! It even set up unit tests for our model and route. Thanks Ember-CLI!\r\n\r\nSo what does this mean for us? Well, we now have a new endpoint on our front-end - [http://localhost:4200/artists](http://localhost:4200/artists). Unfortunately, there's nothing interesting there yet - just the normal \"Welcome to Ember\" message. We still need to tell Ember what this route should actually do. When the user lands on this page, the front-end should request the list of artists from the back-end. Let's implement that.\r\n\r\n## Ember Routes\r\n\r\nIn Ember, routes are responsible for loading data. Open `ember/app/routes/artists.js` and change it to the following:\r\n\r\n````javascript\r\nimport Ember from 'ember';\r\n\r\nexport default Ember.Route.extend({\r\n  model() {\r\n    return this.store.findAll('artist');\r\n  },\r\n});\r\n````\r\n\r\nTranslated to English, we've used the \"store\", which is part of ember-data, to [\"findAll\"](http://emberjs.com/api/data/classes/DS.Store.html#method_findAll) artists on the back-end server. When the store returns data, the data will be set as the \"model\" for this route.\r\n\r\nSave the file and if you still have /artists open in your browser, you'll notice that it auto-reloaded (thanks again Ember-CLI). However, this time, the \"Welcome to Ember\" message has disappeared. Look in the console, and you'll see an error has occurred.\r\n\r\n    GET http://localhost:4200/artists 404 (Not Found)\r\n\r\nThis is good. It means that Ember is now requesting data from the server, but the server replied saying that it has no knowledge about artists.\r\n\r\n## Mojolicious Routes\r\n\r\nIn Mojolicious, routes are responsible for responding to incoming requests. In our application development, the logical next step is to respond to the Ember application's request for artists. Open `mojo/lib/MusicApp.pm`, and change it to the following:\r\n\r\n````perl\r\npackage MusicApp;\r\nuse Mojo::Base 'Mojolicious';\r\n\r\nsub startup {\r\n    my $self = shift;\r\n\r\n    my $artists = [\r\n        {\r\n            id => 1,\r\n            name => \"Michael Jackson\",\r\n        },\r\n        {\r\n            id => 2,\r\n            name => \"Eminem\",\r\n        },\r\n    ];\r\n\r\n    my $r = $self->routes;\r\n\r\n    $r->get('/artists')->to(cb => sub {\r\n        my $c = shift;\r\n        $c->render(json => { artists => $artists });\r\n    });\r\n}\r\n\r\n1;\r\n````\r\n\r\nOK, so we've cheated a bit by hard-coding the artist data. We'll return it as JSON when the something hits the /artists endpoint. In a while we'll replace the hard-coded data by a call to the database, but let's just get it working for now.\r\n\r\nReload the front-end, and the \"Welcome to Ember\" should have reappeared. If you look at the console, the error should have disappeared and if you inspect the network traffic, you should see a successful response from the back-end with the artist data. However, we still don't see the artist data on the page. All that remains to do, is to define how the data should appear on the page.\r\n\r\n## Ember Templates\r\n\r\nIn Ember, templates are responsible for what should be displayed. Open `ember/app/templates/artists.hbs`, and change it to the following:\r\n\r\n````handlebars\r\n{{#each model as |artist|}}\r\n  <div class=\"artist\">\r\n    {{artist.name}}\r\n  </div>\r\n{{/each}}\r\n````","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}